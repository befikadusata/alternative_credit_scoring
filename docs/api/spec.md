# API Specification

This document provides a high-level overview of the credit scoring API endpoints, their purpose, and their data schemas. The API is built using FastAPI, and full, interactive documentation is auto-generated by the service (available at the `/docs` endpoint).

## 0. Authentication

All API endpoints are secured and require authentication. Clients must provide a valid API key in the `X-API-Key` HTTP header for every request.

-   **Header Name:** `X-API-Key`
-   **Value:** A unique, pre-shared API key (e.g., `your-secret-api-key-123`).

Failure to provide a valid API key will result in a `401 Unauthorized` or `403 Forbidden` HTTP response.

## 1. Endpoints

### `POST /predict`

This is the primary endpoint for real-time, single-loan predictions. It is designed for low-latency responses.

-   **Description:** Accepts the features for a single loan application and returns a credit risk assessment.
-   **Request Body:** A JSON object containing the applicant's features.

    *Example Request:*
    ```bash
    curl -X POST "https://api.example.com/predict" \\
         -H "X-API-Key: your-secret-api-key-123" \\
         -H "Content-Type: application/json" \\
         -d '{
               "annual_inc": 65000,
               "emp_length": 5,
               "dti": 18.5,
               "fico_range_low": 680,
               "revol_util": 0.45,
               "inq_last_6mths": 1,
               "purpose": "debt_consolidation"
             }'
    ```

-   **Response Body:** A JSON object containing the prediction, a human-readable explanation, and metadata.

    *Example Response:*
    ```json
    {
      "request_id": "b7e2a9a3-5c5c-4f5e-8b1b-2b3b7c3b2a1a",
      "prediction_score": 0.153,
      "risk_category": "LOW",
      "model_version": "2.1.0",
      "model_used": "champion",
      "explanation": {
        "summary": "This applicant has a low risk of default (15.3% probability).",
        "positive_factors": [
          {"feature": "delinquencies_2yrs", "impact": "+4.2%"},
          {"feature": "revolving_utilization", "impact": "+3.1%"}
        ],
        "negative_factors": [
          {"feature": "fico_score", "impact": "-8.5%"},
          {"feature": "debt_to_income_ratio", "impact": "-5.2%"}
        ]
      }
    }
    ```

### `POST /predict/batch`

This endpoint is designed for offline or bulk processing of multiple loan applications in a single request.

-   **Description:** Accepts a list of loan applications and returns a list of credit risk assessments.
-   **Request Body:** A JSON object containing a list of applications.

    *Example Request:*
    ```bash
    curl -X POST "https://api.example.com/predict/batch" \\
         -H "X-API-Key: your-secret-api-key-123" \\
         -H "Content-Type: application/json" \\
         -d '{
               "applications": [
                 { "id": "app_001", "features": { "annual_inc": 75000, "dti": 15.2, "fico_range_low": 700, "revol_util": 0.3, "emp_length": 10, "inq_last_6mths": 0, "purpose": "home_improvement" }},
                 { "id": "app_002", "features": { "annual_inc": 42000, "dti": 25.8, "fico_range_low": 650, "revol_util": 0.6, "emp_length": 3, "inq_last_6mths": 2, "purpose": "car_purchase" }}
               ]
             }'
    ```

-   **Response Body:** A JSON object containing a list of predictions.

    *Example Response:*
    ```json
    {
      "predictions": [
        { "id": "app_001", "prediction_score": 0.11, "risk_category": "LOW" },
        { "id": "app_002", "prediction_score": 0.45, "risk_category": "MEDIUM" }
      ]
    }
    ```

### `GET /monitoring/health`

This is a standard health check endpoint used for monitoring and service discovery.

-   **Description:** Returns the operational status of the API.
-   **Request Body:** None.

    *Example Request:*
    ```bash
    curl -X GET "https://api.example.com/monitoring/health" \\
         -H "X-API-Key: your-secret-api-key-123"
    ```
-   **Response Body:** A JSON object indicating the service status.

    *Example Response:*
    ```json
    {
      "status": "ok",
      "timestamp": "2025-12-01T12:00:00Z",
      "dependencies": {
        "mlflow_registry": "ok",
        "feature_store": "ok"
      }
    }
    ```
